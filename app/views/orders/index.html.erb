<% content_for :title, "#{Order.unarchived.count} Orders" %>

<%= render 'shared/tab_table_options' %>
<%= render 'shared/new_modal' %>
<br>

<%= paginate @orders %>
<table class="bg-white table table-striped border border-2">
  <thead>
    <tr>
      <% @table_options_to_display.each do |option| %>
            <% if ((option) == 'po_number') || ((option) == 'order_content' )%>
                <th>
                  <%= "#{option}"%>
                </th>
            <% else %>
                <th>
                  <%= link_to "#{option}", request.params.merge(sort_option: "#{option}", sort_direction: sort_direction ) %>
                </th>
            <% end %>
      <% end %>
  </thead>

  <tbody id="table-body">

    <% @orders.each do |order| %>


      <% if order.archived == false %>
        <tr>
          <% @table_options_to_display.each do |option| %>
              <%# byebug %>
              <td>
                <% if (option) == 'id' %>
                  <%= link_to "#{order.id}", order_path(order) %>
                <% elsif (option) == 'ship_name' %>
                  <%= link_to "#{order.purchaser.name}", purchaser_path(order.purchaser) %>
                <% elsif (option) == 'vendor_name' %>
                  <%= link_to "#{order.vendor.name}", vendor_path(order.vendor) %>
                <% elsif (option) == 'date_recieved' %>
                  <%= order.date_recieved ? order.date_recieved.try(:strftime,"%m/%d/%Y") : 'n/a' %>
                <% elsif (option) == 'order_content' %>
                    <% if order.order_content.present? %>
                      <%= link_to(order_path(order)) do %>

                        Boxes: <%= order.order_content.box ||= "n/a" %>
                        <br>
                        Crates: <%= order.order_content.crate ||= "n/a" %>
                        <br>
                        Pallets: <%= order.order_content.pallet ||= "n/a" %>
                        <br>

                        <% if is_nil_and_zero(order.order_content.other) == false %>
                           <%= "Other: #{order.order_content.other}" %>
                           <br>
                           <%= order.order_content.other_description.to_s.chars.count >= 75 ? "Description: #{order.order_content.other_description[0..75]...}" : "Description: #{order.order_content.other_description}" if order.order_content.other_description %>
                        <% end %>
                      <% end %>
                    <% end %>
                <% elsif (option) == 'date_delivered' %>
                  <%= order.date_delivered ? order.date_delivered.try(:strftime,"%m/%d/%Y") : 'n/a' %>
                <% else %>
                  <%#= order.send(option[1]) %>
                  <%= order.send(option[1]) %>
                <% end %>

              </td>
          <% end %>


        </tr>
      <% end %>
    <% end %>

  </tbody>
</table>
